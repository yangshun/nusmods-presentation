<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>NUSMods</title>

    <meta name="description" content="Slides for a NUSHackers talk about NUSMods">
    <meta name="author" content="Yang Shun">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">
      <div class="slides">
        <section>
          <h1>NUSMods</h1>
          <h3>A tale of three tables</h3>
          <p>
            By <a href="https://github.com/yangshun" target="_blank">Yang Shun</a>
          </p>
        </section>

        <section>
          <h2>The Problem</h2>
          <ul>
            <li>Course planning every semester was a pain at the National University of Singapore</li>
            <li>Students were asked to use <a href="https://webrb.nus.edu.sg/ctt/builder.aspx" target="_blank">this</a> to plan their timetable</li>
          </ul>
        </section>

        <section>
          <h1>Scratch your<br>own itch</h1>
        </section>

        <section>
          <h1>NUSMods was born</h1>
        </section>

        <!-- <section>
          <h2>Goals and Objectives</h2>
          <ul>
            <li>Enhance the quality of lives and school experience of NUS students through technology</li>
            <li>Complete knowledge bank of NUS courses by providing useful course-related information such as search-friendly archived CORS bidding statistics and community-driven course reviews and discussions.</li>
            <li>Provide a platform to encourage students to experiment and create original community-engaging work via <a href="https://github.com/nusmodifications/nusmods-api">NUSMods API</a>.</li>
          </ul>
        </section> -->

        <section>
          <h2>Architecture</h2>
          <ul>
            <li>Clear client/server separation</li>
            <li>Web-based timetable builder (Static single page app)
              <ul>
                <li>User-friendly interface</li>
                <li>Filtering and searching through class data</li>
              </ul>
            </li>
            <li>API server
              <ul>
                <li>Static JSON files</li>
                <li>Information scraped daily from <a href="https://myaces.nus.edu.sg/cors/jsp/report/ModuleDetailedInfo.jsp?acad_y=2017/2018&sem_c=1&mod_c=ST2334">publicly accessible course pages</a></li>
            </li>
          </ul>
        </section>

        <section>
          <h2>Timeline</h2>
          <ul>
            <li class="fragment">2012 - Official timetable was not usable. Unofficial version was Windows only. We built a jQuery version.</li>
            <li class="fragment">2014 - Rebuilt with SPA architecture - Backbone and Marionette. Many features were added.</li>
            <li class="fragment">2017 - Rebuilding in React and Redux. Many features will be killed off.</li>
          </ul>
        </section>

        <section>
          <h1>Evolution of NUSMods</h1>
        </section>

        <section>
          <h2><a href="corset/" target="_blank">NUSMods 0.1</a></h2>
          <iframe class="stretch" src="corset/" style="background-color:white"></iframe>
        </section>

        <section>
          <h2><a href="NUSMods-Offline" target="_blank">NUSMods 1.0</a></h2>
          <iframe class="stretch" src="NUSMods-Offline/"></iframe>
          <small>Refresh the page if it doesn't load</small>
        </section>

        <section>
          <h2><a href="https://nusmods.com" target="_blank">NUSMods 2.0</a></h2>
          <iframe class="stretch" src="https://nusmods.com/"></iframe>
        </section>

        <section>
          <h1>NUSMods 3.0</h1>
        </section>

        <section>
          <h3>Key Considerations</h3>
          <ul>
            <li>Mobile-first
              <ul>
                <li>Screen size should not compromise on experience</li>
                <li>Mobile penetration on the rise</li>
              </ul>
            </li>
            <li>Optimize for performance
              <ul>
                <li>Low end devices</li>
                <li>Poor network connectivity</li>
              </ul>
            </li>
            <li>Maintainability
              <ul>
                <li>Future generation of developers</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>Engineering Philosophy</h2>
          <p><em>Nimble but stable</em></p>
          <ul>
            <li>Easily understandable
              <ul>
                <li>Ease onboarding for new developers</li>
                <li>Standardized coding style</li>
                <li>Documented code</li>
              </ul>
            </li>
            <li>Write future-proof code
              <ul>
                <li>Well-tested</li>
                <li>Component/plugin-based architecture and workflow</li>
                <li>Clearly defined abstractions between layers in the app</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h3>Stack Evolution</h3>
          <table>
            <tr>
              <th></th>
              <th>v2.0</th>
              <th>v3.0</th>
            </tr>
            <tr>
              <td><small>Bundler</small></td>
              <td>Grunt + Browserify</td>
              <td>Webpack</td>
            </tr>
            <tr>
              <td><small>Language</small></td>
              <td>ES5</td>
              <td>ES6 / Babel</td>
            </tr>
            <tr>
              <td><small>Package Manager</small></td>
              <td>NPM</td>
              <td>Yarn</td>
            </tr>
            <tr>
              <td><small>App</small></td>
              <td>Backbone + Marionette</td>
              <td>React + Redux</td>
            </tr>
            <tr>
              <td><small>Types</small></td>
              <td>N/A</td>
              <td>Flow</td>
            </tr>
            <tr>
              <td><small>Tests</small></td>
              <td>N/A</td>
              <td>Jest + Enzyme</td>
            </tr>
            <tr>
              <td><small>Style</small></td>
              <td>JSHint</td>
              <td>ESLint + Airbnb Style Guide</td>
            </tr>
          </table>
        </section>

        <section>
          <h2>V3.0 Client App Stack</h2>
        </section>

        <section>
          <h3>View - React</h3>
          <ul>
            <li>Declarative
              <ul>
                <li>Describe what you want, instead of how you want</li>
                <li>By looking at the template code, you know how the final result will look like</li>
                <li>Fewer hops in logic required</li>
              </ul>
            </li>
            <li>Predictable
              <ul>
                <li>UI is a function of state: <code>render(data) -> view</code></li>
                <li>Given this set of data, A, the rendered output will definitely look like B</li>
              </ul>
            </li>
            <li>Component-based</li>
          </ul>
        </section>

        <section>
          <h3>Logic - Redux</h3>
          <ul>
            <li>Flux architecture</li>
            <li>Single, Global State Tree
              <ul>
                <li>Single source of truth. Data stays in sync for different parts of the application.</li>
                <li>Undo/redo made easy</li>
              </ul>
            </li>
            <li>Changes are made with pure functions
              <ul>
                <li>Reducers are pure functions that take the previous state and an action, and computes the next state.</li>
                <li><code>reducer(state, action) -> nextState</code></li>
              </ul>
            </li>
            <li>Good for interactive apps where changes to app state can be made from many places.</li>
          </ul>
        </section>

        <section>
          <h3>Types - Flow</h3>
          <ul>
            <li>Ease of adoption as compared to TypeScript</li>
            <li>Jells well with the other Facebook tools</li>
          </ul>
        </section>

        <section>
          <ul>
            <li>Implicit form of documentation</li>
          </ul>
          <pre><code data-trim>
type Module = {
  AcadYear: string,
  CorsBiddingStats: Array&lt;BiddingStat&gt;,
  Department: string,
  ModuleCode: string,
  ModuleCredit: string,
  ModuleDescription: string,
  ModuleTitle: string,
  Preclusion?: string,
  Prerequisite?: string,
  Types: Array&lt;string&gt;,
  Workload?: string
};
          </code></pre>
          <pre><code data-trim>
type Lesson = {
  ClassNo: string,
  DayText: string,
  EndTime: string,
  LessonType: string,
  ModuleCode: string,
  StartTime: string,
  Venue: string,
  WeekText: string
};
          </code></pre>
        </section>

        <section>
          <h2>Key Considerations Revisited</h2>
        </section>

        <section>
          <h3>Mobile First</h3>
          <p>Develop for the phone first, using Chrome/Firefox's mobile debugger</p>
          <p>Use media queries intensively</p>
        </section>

        <section>
          <h1>Courage</h1>
          <p>Drag n Drop too unintuitive</p>
          <p>Clicking is easier, faster and less technically challenging</p>
          <h3>Good bye DnD</h3>
        </section>

        <section>
          <h3>Theme Colors</h3>
          <ul>
            <li>Killing of unpopular colors</li>
            <li>The feature everyone wanted: Colorpickers</li>
          </ul>
        </section>

        <section>
          <h3>Offline first</h3>
          <ul>
            <li>Better usage experience</li>
            <li>Especially important for mobile devices</li>
          </ul>
        </section>

        <section>
          <h2>How?</h2>
          <ul>
            <li>Progressive Web App</li>
            <li>Service workers</li>
            <li>localStorage</li>
          </ul>
        </section>

        <section>
          <h3>Flexible start/end timings</h3>
          <ul>
            <li>We realised lessons that start at 6am exists</li>
            <li>So did lessons that ended at midnight</li>
            <li>So which hours do we present?</li>
          </ul>
        </section>

        <section>
          <h4>Analysis!</h4>
          <ul>
            <li>Plot out all lessons' start and end time for the semester</li>
            <li>~90% of lessons lie between 10am and 7pm</li>
          </ul>
        </section>

        <section>
          <h4>Graphs</h4>
          <img src="./img/end-time-lessons.png">
        </section>

        <section>
          <h4>More Graphs!</h4>
          <img src="./img/start-time-lessons.png">
        </section>

        <section>
          <h3>Orientation</h3>
          <ul>
            <li>Landscape works better on wide screens</li>
            <li>Portrait works better on narrow screens</li>
            <li>Solution: Toggleable orientation</li>
          </ul>
        </section>

        <section>
          <h2>Timetable Implementation</h2>
          <p>A tale of tables, boxes and blocks</p>
        </section>

        <section>
          <h3>Code for a simple timetable</h3>
          <img src="./img/stack-of-books.jpg">
        </section>

        <section>
          <h3>Attempt 1 - Tables</h3>
          <p>Too difficult to work with. Tables are not responsive</p>
          <p>Would require two sets of markup and styles</p>
        </section>

        <section>
          <h3>Attempt 2 - Flexbox</h3>
          <p>Using <code>flex-direction</code></p>
          <p>Simplest and most elegant</p>
          <p>But too many <a href="https://github.com/philipwalton/flexbugs">cross browser bugs</a></p>
        </section>

        <section>
          <h3>Attempt 3 - Hybrid</h3>
          <p><code>inline-block</code> with dynamic percentage-based<br><code>height</code> and <code>width</code></p>
          <p>A mix of JavaScript and CSS</p>
          <p>One set of markup, two set of styles</p>
          <p>Good browser support, guaranteed to work</p>
        </section>

        <section>
          <h3>Future Attempts</h3>
          <p>CSS Grids: the future?</p>
        </section>

        <section>
          <h1>V3.0 Demo</h1>
          <p><a href="http://v3.nusmods.com">http://v3.nusmods.com</a></p>
        </section>

        <section>
          <h2>Timetabling Algorithm</h2>
          <p>Series of data transformations</p>
          <pre><code data-trim>
type Lesson = {
  ClassNo: string,
  DayText: string,
  EndTime: string,
  LessonType: string,
  ModuleCode: string,
  StartTime: string,
  Venue: string,
  WeekText: string
};
          </code></pre>
          <p>Starts with an array of <code>Lesson</code>s</p>
        </section>

        <section>
          <h3>Group Lessons by Days</h3>
          <pre><code data-trim>
// Flat array
[LessonA, LessonB, LessonC, LessonD, ...];

// Grouped by day
{
    Monday: [LessonA, LessonB, LessonC],
    Tuesday: [LessonD, ...]
};
          </code></pre>
        </section>

        <section>
          <h3>Arrange Lesson within each Day</h3>
          <pre><code data-trim>
// Grouped by day
{
    Monday: [LessonA, LessonB, LessonC],
    Tuesday: [LessonD, ...]
};

// Resolve collisions within day
{
    Monday: [
        [LessonA, LessonB],
        [LessonC],
    ],
    Tuesday: [
        [LessonD, ...]
    ],
    ...
};
          </code></pre>
          <p>Generic useful timetable model representation. Potentially reuse in a React Native app?</p>
          <p>Detailed explanation found <a href="https://gist.github.com/yangshun/ee7f1a4fee5b221a93ffb8a1b9f3de47">here</a></p>
        </section>

    <!--     <section>
          <h2>NUSModerator.js Library</h2>
          <p><a href="https://github.com/nusmodifications/nusmoderator">https://github.com/nusmodifications/nusmoderator</a></p>
          <p><em>Utlity toolbelt for nus applications</em></p>
          <ul>
            <li>Academic week calculation</li>
            <li>TBD: Timetable generation algorithm and various utility functions. You can build your own timetabling client</li>
            <li>TBD: Matric number letter calculation</li>
            <li>TBD: Wrapper for NUSMods API</li>
          </ul>
        </section> -->

       <!--  <section>
          <h2>Open Source</h2>
          <p><a href="https://github.com/nusmodifications/react-redux-starter">React Redux Starter</a> - Cutting edge web app boilerplate. Non-abstracted version of Create React App.</p>
          <p><a href="https://github.com/nusmodifications/npm-starter">NPM ES6 Starter</a> - Boilerplate for writing libraries to be published via NPM.</p>
        </section> -->

        <section>
          <h2>Acknowledgements</h2>
          <img src="./img/acknowledgements.png"/>
          <a href="https://nusmods.com/team">https://nusmods.com/team</a>
        </section>

        <section style="text-align: left;">
          <h1>The End</h1>
          <p>
            By <a href="https://github.com/nusmodifications">NUSModifications</a> <br>
          </p>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
